## 定位
Graphi 是一个处于传统和Faas之间的API层。主要由两部分组成，一个是文档平台，一个是API网关。在小型轻量应用中，也可以当网关使用。

![业务架构](./images/1.png)

## 文档平台
文档平台用来定义接口参数，调用配置等信息。不使用Faas，也可以用作普通的文档管理。

### 项目
Graphi用项目来聚合接口，原则上一个项目对应一组API网关的实例。

### Schema
schema 是数据模型，主要是在定义接口时，提供可复用的数据结构。

### 接口
接口是文档平台的核心部分。

#### 基础信息
- 名称：方便搜索和查找文档
- 方法：GET，POST，PUT，DELETE
- 路由：接口地址，和方法组成唯一的地址，不区分大小写
- 状态：开发|测试|发布

#### API 信息
API在项目类型选为API时才会出现
- resolve：处理接口的函数
- 缓存：是否缓存接口数据

#### 参数定义


### 系统配置
与API网关交互的配置

### Hooks
其他系统对文档平台的监听

### Code Generation
生成各个语言调用文档的SDK或代码片段

### 版本管理
当文档编辑完成，接口开发完成后，生成待发布版本供测试和发布使用。版本生成后不再允许变更。

## API网关
网关有开发和生产两种模式。

### 接口实时同步（DEV）
只在开发模式下有效。监听文档平台的hooks，实时获取最新的文档数据。

### 接口初始化（PROD）
只在生产模式下有效。在系统镜像build时，读取指定版本文档信息，以文件形式存储在本地。以后系统重启不再拉取。

### 路由解析
系统启动时，对每一个路由生成一个Graphql的Schema实列，通过路由指定实例进行处理。

### 缓存（PROD）
如果接口指定了缓存和时长，先从缓存中获取数据。

### Mock（DEV）
开发模式下，如果接口状态为开发中，使用Mock数据。

### Graphql
通过Graphql来过滤和校验参数，通过在resolve中指定的云函数SDK调用对应的云函数。

### 云函数SDK
通过SDK插件调用云函数。多个云平台使用不同的SDK插件。

## 部署
文档平台和API网关都通过docker部署